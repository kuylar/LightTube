/**
 * LTPlayer
 * https://github.com/kuylar/LTPlayer
 */
class Player{constructor(e,t){if(this.player=document.querySelector(e),this.player.removeAttribute("controls"),this.info=t,this.playerType="html5",this.controlsHideTime=Number.MAX_SAFE_INTEGER,!t)throw Error("info must be provided while constructing a new Player instance!");t.chapters&&0!=t.chapters.length||(t.chapters=[{from:0,to:100,name:""}]),this.root=this.buildPlayerElement({author:t.author,title:t.title,playButtonHtml:t.buttons.play,pauseButtonHtml:t.buttons.pause,muteButtonHtml:t.buttons.volumeMedium,settingsButtonHtml:t.buttons.settings,fullscreenButtonHtml:t.buttons.fullscreen,minimizeButtonHtml:t.buttons.minimize,chapters:t.chapters}),this.player.parentElement.insertBefore(this.root,this.player),this.root.insertBefore(this.player,this.root.firstElementChild),t.hlsManifest&&Hls.isSupported()&&(this.playerType="hls.js",this.hlsjs=new Hls,this.hlsjs.on(Hls.Events.MANIFEST_PARSED,(e,t)=>{console.log(`[HLS.JS] Manifest parsed with ${t.levels.length} quality levels`),this.updateSelects()}),this.hlsjs.on(Hls.Events.LEVEL_SWITCHED,(e,{level:t})=>{console.log(`[HLS.JS] Switched to the quality level ${this.hlsjs.levels[t].height}p (${t})`),this.updateSelects()}),this.hlsjs.loadSource(t.hlsManifest),this.hlsjs.attachMedia(this.player)),this.assignEvents(),this.updateButtons(),this.updateSelects()}buildPlayerElement(e){let t=[],s=document.createElement("DIV");s.setAttribute("class","ltp-root");let l=document.createElement("DIV");l.setAttribute("class","ltp-gradient-top"),s.appendChild(l);let i=document.createElement("DIV");i.setAttribute("class","ltp-title");let n=document.createElement("A");n.setAttribute("class","ltp-title__icon"),n.setAttribute("style",`background-image: url('${e.author?.icon}');background-size:contain;`),n.setAttribute("href",e.author?.href),n.setAttribute("title",e.author?.title),i.appendChild(n);let r=document.createElement("SPAN");r.setAttribute("class","ltp-title__text"),r.innerHTML=e.title,i.appendChild(r),s.appendChild(i);let a=document.createElement("DIV");a.setAttribute("class","ltp-gradient-bottom"),s.appendChild(a);let o=document.createElement("DIV");for(let h of(o.setAttribute("class","ltp-progress-container"),e.chapters)){let u=document.createElement("DIV");u.setAttribute("class","ltp-progress"),u.setAttribute("title",h.name),u.style.width=h.to-h.from+"%";let p=document.createElement("DIV");p.setAttribute("class","ltp-progress__buffered"),u.appendChild(p);let m=document.createElement("DIV");m.setAttribute("class","ltp-progress__played"),u.appendChild(m),o.appendChild(u),t.push({name:h.name,to:h.to,from:h.from,background:u,buffered:p,played:m})}s.appendChild(o);let d=document.createElement("DIV");d.setAttribute("class","ltp-controls");let c=document.createElement("DIV");c.setAttribute("class","ltp-controls-button"),c.innerHTML=e.playButtonHtml,d.appendChild(c);let y=document.createElement("DIV");y.setAttribute("class","ltp-controls-button"),y.innerHTML=e.pauseButtonHtml,d.appendChild(y);let b=document.createElement("DIV");b.setAttribute("class","ltp-controls-volume-icon");let f;f=this.player.muted?this.info.buttons.volumeMute:this.player.volume>.7?this.info.buttons.volumeHigh:this.player.volume<.3?this.info.buttons.volumeLow:this.info.buttons.volumeMedium,b.innerHTML=f,d.appendChild(b);let E=document.createElement("DIV");E.setAttribute("class","ltp-controls-volume");let g=document.createElement("DIV");g.setAttribute("class","ltp-controls-volume-bar");let v=document.createElement("DIV");v.setAttribute("class","ltp-controls-volume-value"),g.appendChild(v),E.appendChild(g),d.appendChild(E);let $=document.createElement("DIV");$.setAttribute("class","ltp-controls-timestamp"),$.innerHTML="--:-- / --:--",d.appendChild($);let C=document.createElement("DIV");C.setAttribute("class","ltp-controls-divider"),d.appendChild(C);let A=document.createElement("DIV");A.setAttribute("class","ltp-controls-button"),A.innerHTML=e.settingsButtonHtml,d.appendChild(A);let T=document.createElement("DIV");T.setAttribute("class","ltp-controls-button"),T.innerHTML=e.fullscreenButtonHtml,d.appendChild(T);let M=document.createElement("DIV");M.setAttribute("class","ltp-controls-button"),M.innerHTML=e.minimizeButtonHtml,d.appendChild(M),s.appendChild(d);let B=document.createElement("DIV");B.setAttribute("class","ltp-menu");let L=document.createElement("LABEL");L.setAttribute("class","ltp-menuitem");let k=document.createElement("SPAN");k.innerHTML="Playback speed",L.appendChild(k);let S=document.createElement("SELECT");S.appendChild(this.createMenuOption("0.25",".25")),S.appendChild(this.createMenuOption("0.50",".5")),S.appendChild(this.createMenuOption("0.75",".75")),S.appendChild(this.createMenuOption("Normal","1",!0)),S.appendChild(this.createMenuOption("1.25","1.25")),S.appendChild(this.createMenuOption("1.50","1.5")),S.appendChild(this.createMenuOption("1.75","1.75")),S.appendChild(this.createMenuOption("2","2")),L.appendChild(S),B.appendChild(L);let H=document.createElement("LABEL");H.setAttribute("class","ltp-menuitem");let I=document.createElement("SPAN");I.innerHTML="Subtitles/CC",H.appendChild(I);let O=document.createElement("SELECT");H.appendChild(O),B.appendChild(H);let _=document.createElement("LABEL");_.setAttribute("class","ltp-menuitem");let w=document.createElement("SPAN");w.innerHTML="Quality",_.appendChild(w);let D=document.createElement("SELECT");_.appendChild(D),B.appendChild(_);let j=document.createElement("LABEL");j.setAttribute("class","ltp-menuitem");let V=document.createElement("SPAN");V.innerHTML="Audio track",j.appendChild(V);let x=document.createElement("SELECT");return j.appendChild(x),B.appendChild(j),s.appendChild(B),_.style.display="none",H.style.display="none",j.style.display="none",B.style.display="none",this.elements={authorIcon:n,videoTitle:r,timestamp:$,volumeBar:v,progressBarSections:t,buttons:{play:c,pause:y,mute:b,settings:A,fullscreen:T,minimize:M},menus:{menu:B,speed:S,quality:D,subtitles:O,audioTracks:x}},s}createMenuOption(e,t,s){let l=document.createElement("OPTION");return l.innerHTML=e,l.setAttribute("value",t),s&&l.setAttribute("selected","selected"),l}assignEvents(){this.elements.buttons.play.onclick=()=>{this.player.play()},this.elements.buttons.pause.onclick=()=>{this.player.pause()},this.player.onpause=()=>{this.updateButtons()},this.player.onplay=()=>{this.updateButtons()},this.player.onclick=()=>{this.player.paused?this.player.play():this.player.pause()},this.player.ondblclick=()=>{window.fullScreen?document.exitFullscreen().then(()=>{this.updateButtons()}).catch(()=>{this.updateButtons()}):this.root.requestFullscreen({navigationUI:"hide"}).then(()=>{this.updateButtons()}).catch(()=>{this.updateButtons()})},this.player.onmousemove=()=>{this.root.classList.remove("controls-hidden"),this.controlsHideTime=Date.now()+5e3},this.elements.buttons.mute.onclick=()=>{this.player.muted=!this.player.muted,this.updateButtons()},this.elements.buttons.fullscreen.onclick=()=>{this.root.requestFullscreen({navigationUI:"hide"}).then(()=>{this.updateButtons()}).catch(()=>{this.updateButtons()})},this.elements.buttons.minimize.onclick=()=>{document.exitFullscreen().then(()=>{this.updateButtons()}).catch(()=>{this.updateButtons()})},this.player.ontimeupdate=()=>{Date.now()>this.controlsHideTime&&!this.root.classList.contains("controls-hidden")?this.root.classList.add("controls-hidden"):Date.now()<this.controlsHideTime&&this.root.classList.contains("controls-hidden")&&this.root.classList.remove("controls-hidden"),this.resizeProgressBar("played",this.player.currentTime/this.player.duration*100)},this.player.onvolumechange=()=>{this.elements.volumeBar.style.width=100*this.player.volume+"%";let e;e=this.player.muted?this.info.buttons.volumeMute:this.player.volume>.7?this.info.buttons.volumeHigh:this.player.volume<.3?this.info.buttons.volumeLow:this.info.buttons.volumeMedium,this.elements.buttons.mute.innerHTML=e},this.elements.volumeBar.parentElement.parentElement.onclick=e=>{this.player.volume=this.percentageFromMouseOverEvent(e,this.elements.volumeBar.parentElement)},this.elements.progressBarSections[0].background.parentElement.onclick=e=>{this.player.currentTime=this.percentageFromMouseOverEvent(e,this.elements.progressBarSections[0].background.parentElement)*this.player.duration},this.elements.buttons.settings.onclick=()=>{"none"===this.elements.menus.menu.style.display?this.elements.menus.menu.style.display="flex":this.elements.menus.menu.style.display="none"},this.elements.menus.speed.onchange=()=>{this.player.playbackRate=parseFloat(this.elements.menus.speed.value)},this.elements.menus.quality.onchange=()=>{switch(this.playerType){case"html5":let e=this.player.currentTime;this.player.src=this.elements.menus.quality.value,this.player.currentTime=e;break;case"hls.js":let t=this.elements.menus.quality.value;this.hlsjs.nextLevel=parseInt(t);break;default:console.error(`Unknown player type ${this.playerType}`)}},this.elements.menus.audioTracks.onchange=()=>{"hls.js"===this.playerType?this.hlsjs.audioTrack=parseInt(this.elements.menus.audioTracks.value):console.error(`Unknown player type ${this.playerType}`)},this.elements.menus.subtitles.onchange=()=>{for(let e=0;e<this.player.textTracks.length;e++)this.player.textTracks[e].mode="hidden";if("null"===this.elements.menus.subtitles.value)return;let t=Array.from(this.player.textTracks).filter(e=>e.label===this.elements.menus.subtitles.value)[0];t.mode="showing"},setInterval(()=>{this.player.buffered.length>0&&this.resizeProgressBar("buffered",this.player.buffered.end(this.player.buffered.length-1)/this.player.duration*100,!0),this.elements.timestamp.innerText=`${this.timestampFromMs(this.player.currentTime)} / ${this.timestampFromMs(this.player.duration)}`},100)}updateButtons(){this.player.paused?(this.elements.buttons.pause.style.display="none",this.elements.buttons.play.style.display="flex"):(this.elements.buttons.play.style.display="none",this.elements.buttons.pause.style.display="flex"),window.fullScreen?(this.elements.buttons.fullscreen.style.display="none",this.elements.buttons.minimize.style.display="flex"):(this.elements.buttons.minimize.style.display="none",this.elements.buttons.fullscreen.style.display="flex")}percentageFromMouseOverEvent(e,t){return t||(t=e.target),this.remapNumber(e.clientX,t.getBoundingClientRect().left,t.getBoundingClientRect().left+t.clientWidth-1,0,1)}timestampFromMs(e){let t=e,s=Math.round(t/3600);t%=3600;let l=Math.round(t/60).toString().padStart(2,"0");return t=Math.round(t%60).toString().padStart(2,"0"),s>0?`${s}:${l}:${t}`:`${l}:${t}`.replaceAll("NaN","--")}resizeProgressBar(e,t,s=!1){let l=!1;for(let i of this.elements.progressBarSections)l?i[e].style.width="0%":0<=t&&t<=0+i.to?(i[e].style.width=this.remapNumber(t,i.from,i.to,0,100)+"%",l=!0):i[e].style.width="100%"}remapNumber(e,t,s,l,i){return(e-t)*(i-l)/(s-t)+l}updateSelects(){switch(this.playerType){case"html5":let e=Array.from(this.player.children),t=e.filter(e=>"SOURCE"===e.tagName),s=Array.from(this.player.textTracks).filter(e=>"vtt"===e.groupId);if(t.length>1){let l=!1,i=[];for(let n of t){let r=n.getAttribute("label"),a=n.getAttribute("src"),o=a===this.player.currentSrc;o&&(l=!0),i.push(this.createMenuOption(r,a,o))}for(let h of(l||i[0].setAttribute("selected","selected"),i))this.elements.menus.quality.appendChild(h);this.elements.menus.quality.parentElement.style.display="flex"}if(s.length>0){let u=!1,p=[];for(let m of(p.push(this.createMenuOption("Off",null)),s)){let d=m.label,c="showing"===m.mode;c&&(u=!0),p.push(this.createMenuOption(d,d,c))}for(let y of(u||p[0].setAttribute("selected","selected"),p))this.elements.menus.subtitles.appendChild(y);this.elements.menus.subtitles.parentElement.style.display="flex"}break;case"hls.js":let b=[],f=this.hlsjs.levels.filter(e=>e.videoCodec.startsWith("avc1")),E=this.hlsjs.currentLevel>0?this.hlsjs.levels[this.hlsjs.currentLevel].height:void 0,g=[];for(let v of(this.hlsjs.autoLevelEnabled?g.push(this.createMenuOption(`Auto (${E}p)`,-1,!0)):g.push(this.createMenuOption("Auto",-1)),f))b.includes(v.height)||(b.push(v.height),g.push(this.createMenuOption(v.height+"p",this.hlsjs.levels.indexOf(v),v.height===E&&!this.hlsjs.autoLevelEnabled)));for(;this.elements.menus.quality.firstElementChild;)this.elements.menus.quality.children[0].remove();for(let $ of g)this.elements.menus.quality.appendChild($);if(this.elements.menus.quality.parentElement.style.display="flex",this.hlsjs.audioTracks.length>1){let C=[];for(let A of this.hlsjs.audioTracks)C.push(this.createMenuOption(A.name,A.id,this.hlsjs.audioTrack==A.id));for(;this.elements.menus.audioTracks.firstElementChild;)this.elements.menus.audioTracks.children[0].remove();for(let T of C)this.elements.menus.audioTracks.appendChild(T);this.elements.menus.audioTracks.parentElement.style.display="flex"}let M=Array.from(this.player.textTracks).filter(e=>"vtt"===e.groupId);if(console.log(M),M.length>0){let B=!1,L=[];for(let k of(L.push(this.createMenuOption("Off",null)),M)){let S=k.label,H="showing"===k.mode;H&&(B=!0),L.push(this.createMenuOption(S,S,H))}for(B||L[0].setAttribute("selected","selected");this.elements.menus.subtitles.firstElementChild;)this.elements.menus.subtitles.children[0].remove();for(let I of L)this.elements.menus.subtitles.appendChild(I);this.elements.menus.subtitles.parentElement.style.display="flex"}break;default:console.error(`Unknown player type: ${this.playerType}`)}}}